
# 共 9 个节点，3 主 6 从

# 在每一个节点执行

apt install -y redis

if [ "`grep ^bind /etc/redis/redis.conf`" == "" ]; then echo "bind 0.0.0.0" >> /etc/redis/redis.conf; else sed -i "s/^bind.*$/bind 0.0.0.0/g" /etc/redis/redis.conf; fi

if [ "`grep ^cluster-enabled /etc/redis/redis.conf`" == "" ]; then echo "cluster-enabled yes" >> /etc/redis/redis.conf; else sed -i "s/^cluster-enabled.*$/cluster-enabled yes/g" /etc/redis/redis.conf; fi

if [ "`grep ^cluster-node-timeout /etc/redis/redis.conf`" == "" ]; then echo "cluster-node-timeout 5000" >> /etc/redis/redis.conf; else sed -i "s/^cluster-node-timeout.*$/cluster-node-timeout 5000/g" /etc/redis/redis.conf; fi

if [ "`grep ^appendonly /etc/redis/redis.conf`" == "" ]; then echo "appendonly yes" >> /etc/redis/redis.conf; else sed -i "s/^appendonly.*$/appendonly yes/g" /etc/redis/redis.conf; fi

if [ "`grep ^cluster-config-file /etc/redis/redis.conf`" == "" ]; then echo "cluster-config-file nodes-6379.conf" >> /etc/redis/redis.conf; else sed -i "s/^cluster-config-file.*$/cluster-config-file nodes-6379.conf/g" /etc/redis/redis.conf; fi

systemctl restart redis


# 在第一个节点执行

redis-cli --cluster create 192.168.1.241:6379 192.168.1.242:6379 192.168.1.243:6379 192.168.1.244:6379 192.168.1.245:6379 192.168.1.246:6379 192.168.1.247:6379 192.168.1.248:6379 192.168.1.249:6379 --cluster-replicas 2

